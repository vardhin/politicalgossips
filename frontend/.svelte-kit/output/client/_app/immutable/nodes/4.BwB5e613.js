import{t as I,a as O}from"../chunks/D7uXA1Ur.js";import{i as z}from"../chunks/BUZb4uKt.js";import{m as F,t as J,o as s,q as G,$ as H,x as d,w as M,z as p,y as n,v as l,A as i,B as K}from"../chunks/C6NBa0eJ.js";import{h as Q,e as V,s as x}from"../chunks/Bh918-OH.js";import{i as W}from"../chunks/BHvfjOCM.js";import{s as X,P as u,r as N}from"../chunks/BGlFHzz6.js";import{b as P}from"../chunks/Bn_oBZ8q.js";import{o as Y}from"../chunks/HOlLVa_p.js";import{g as Z}from"../chunks/f-XVoPzV.js";var ee=I('<div class="error-message svelte-12mildj"><p> </p></div>'),se=I('<div class="login-container svelte-12mildj"><div class="login-card glass-panel svelte-12mildj"><h1 class="svelte-12mildj">Admin Login</h1> <div> </div> <!> <form><div class="form-group svelte-12mildj"><label for="username" class="svelte-12mildj">Username</label> <input type="text" id="username" required class="svelte-12mildj"></div> <div class="form-group svelte-12mildj"><label for="password" class="svelte-12mildj">Password</label> <input type="password" id="password" required class="svelte-12mildj"></div> <button type="submit" class="login-btn svelte-12mildj"> </button></form> <div class="back-link svelte-12mildj"><a href="/" class="svelte-12mildj">Back to Home</a></div></div></div>');function me(q,A){F(A,!1);let h=p(""),b=p(""),f=p(""),c=p(!1),v=p("Checking...");Y(async()=>{await B()});async function B(){try{const e=[`${u}/health`,`${u}/api/health`,`${u}`];let a=null;for(const o of e)try{console.log("Checking backend connection at:",o);const m=await(await fetch(o)).text();let r;try{return r=JSON.parse(m),console.log("Backend response data:",r),r.status&&r.dbState?n(v,`Backend: ${r.status}, DB: ${r.dbState}`):r.status?n(v,`Backend: ${r.status}`):n(v,"Backend connected"),!0}catch{throw console.warn("Response not valid JSON:",m.substring(0,100)),new Error("Invalid JSON response")}}catch(t){a=t,console.warn(`Failed to connect to ${o}:`,t.message)}throw a||new Error("All backend connection attempts failed")}catch(e){return console.error("Backend connection check failed:",e),n(v,"Backend unavailable"),!1}}async function T(e){e.preventDefault(),n(c,!0),n(f,"");try{if(!await B())throw new Error("Cannot connect to the backend server");console.log("Sending login request to:",`${u}/auth/login`);const o=await fetch(`${u}/auth/login`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({username:s(h),password:s(b)})});console.log("Login response status:",o.status);let t;const m=await o.text();console.log("Raw response:",m);try{t=JSON.parse(m),console.log("Parsed response data:",t)}catch(r){throw console.error("JSON parse error:",r),new Error("Invalid response from server: "+m.substring(0,100))}if(!o.ok)throw new Error(t.message||"Login failed");localStorage.setItem("authToken",t.accessToken),localStorage.setItem("user",JSON.stringify(t.user)),Z("/admin/dashboard")}catch(a){console.error("Login error:",a),n(f,a.message)}finally{n(c,!1)}}z();var w=se();Q(e=>{H.title="Admin Login - Political Gossips"});var L=l(w),g=d(l(L),2);let C;var R=l(g,!0);i(g);var E=d(g,2);{var U=e=>{var a=ee(),o=l(a),t=l(o,!0);i(o),i(a),J(()=>x(t,s(f))),O(e,a)};W(E,e=>{s(f)&&e(U)})}var k=d(E,2),_=l(k),y=d(l(_),2);N(y),i(_);var j=d(_,2),S=d(l(j),2);N(S),i(j);var $=d(j,2),D=l($,!0);i($),i(k),K(2),i(L),i(w),J(e=>{C=X(g,1,"backend-status svelte-12mildj",null,C,e),x(R,s(v)),y.disabled=s(c),S.disabled=s(c),$.disabled=s(c),x(D,s(c)?"Logging in...":"Login")},[()=>({error:s(v).includes("unavailable")})],M),P(y,()=>s(h),e=>n(h,e)),P(S,()=>s(b),e=>n(b,e)),V("submit",k,T),O(q,w),G()}export{me as component};
